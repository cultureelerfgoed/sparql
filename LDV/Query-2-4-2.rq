#+ name: Query-2-4-2
#+ endpoint: https://api.linkeddata.cultureelerfgoed.nl/datasets/rce/Rijksmonumenten-sdo/services/Rijksmonumenten-sdo-jena/sparql

PREFIX text:  <http://jena.apache.org/text#>
PREFIX schema:<https://schema.org/>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX ceo:   <https://linkeddata.cultureelerfgoed.nl/def/ceo#>
PREFIX edm:   <http://www.europeana.eu/schemas/edm/>
PREFIX dc:    <http://purl.org/dc/elements/1.1/>

SELECT DISTINCT
  (URI(CONCAT("https://monumentenregister.cultureelerfgoed.nl/monumenten/", ?rijksmonumentnummer)) AS ?monumentenregister)
  ?functies
  ?adres
  ?literal
  ?naam
  ?plaats
  ?monumentaard
  ?heeftUitsluiting
  ?heeftRelatieveWaardering
  ?heeftReden
  ?primaireCategorie
  ?categorieen

WHERE {
  # Full-text: één stringliteral, zonder dubbele termen
(?choi ?sc ?literal) text:query (
  schema:description
'("niet beschermd" OR "niet-beschermd" OR "niet van waarde" OR "geen onderdeel" OR uitgesloten OR uitgezonderd OR "niet opgenomen" OR "niet onder bescherming" OR ondergeschikt OR "van ondergeschikt belang" OR secundair OR "weinig waarde" OR "van weinig waarde" OR "onderdeel van" OR "in samenhang met" OR "niet meebeschermd" OR "niet-meebeschermd" OR "niet in aanmerking" OR "buiten bescherming" OR "niet nader te beschermen" OR "niet oorspronkelijk" OR "niet originele" OR "niet origineel" OR "in recente tijd" OR "ondergeschikte betekenis" OR "sterk gewijzigd" OR "ingrijpend gewijzigd" OR "aanzienlijk gewijzigd")'  ) .

  # Basisgegevens
  ?choi schema:description      ?omschrijving ;
        schema:identifier       ?rijksmonumentnummer ;
        schema:addressLocality  ?plaats ;
        schema:category         ?monumentaard .
  OPTIONAL {
    ?choi schema:additionalType ?functie .
    BIND(REPLACE(?functie, "\\s\\(.*\\)|\\(.*\\)", "") AS ?functies)
  }
  OPTIONAL { ?choi schema:address       ?adres . }
  OPTIONAL { ?choi schema:name          ?naam  . }

  # Taalfilter (NL of taalloos)
  FILTER( langMatches(lang(?omschrijving), "nl") || lang(?omschrijving) = "" )

  # Classificatie (zonder 'vanwege'), met hyphen-varianten en extra vormen
  BIND(LCASE(STR(?omschrijving)) AS ?omslLc)

BIND(
  "niet-?\\s*beschermd|niet\\s+van\\s+waarde|geen\\s+onderdeel|uitgezonderd|niet\\s+opgenomen|niet\\s+onder\\s+bescherming|\\buitgesloten\\b|niet-?\\s*meebeschermd|niet\\s+in\\s+aanmerking|\\bafgebroken\\b|buiten\\s+bescherming|niet\\s+nader\\s+te\\s+beschermen"
  AS ?patUitsl
)
BIND(
  "\\bondergeschikt(e)?\\b|van\\s+ondergeschikt\\s+belang|ondergeschikte\\s+betekenis|\\bsecundair(e)?\\b|van\\s+weinig\\s+waarde|weinig\\s+waarde|\\bgering(e|ere)?\\b|van\\s+geringe\\s+waarde|\\bstorend\\b|niet\\s+oorspronkelijk(e)?|niet\\s+origineel|in\\s+recente\\s+tijd|\\b(sterk|ingrijpend|aanzienlijk)\\s+gewijzigd\\b"
  AS ?patRel
)

BIND(
  "\\bonderdeel\\s+van\\b|in\\s+samenhang\\s+met|aanmerking\\s+voor|\\baanmerking\\b"
  AS ?patReden
)


  BIND( REGEX(?omslLc, ?patUitsl) AS ?heeftUitsluiting )
  BIND( REGEX(?omslLc, ?patRel)   AS ?heeftRelatieveWaardering )
  BIND( REGEX(?omslLc, ?patReden) AS ?heeftReden )

  BIND(
    IF(?heeftUitsluiting, "uitsluiting of beperking",
      IF(?heeftRelatieveWaardering, "relatieve waardering",
        IF(?heeftReden, "verwijzing naar reden van bescherming", "")
      )
    ) AS ?primaireCategorie
  )

  BIND(CONCAT(
        IF(?heeftUitsluiting, "uitsluiting of beperking|", ""),
        IF(?heeftRelatieveWaardering, "relatieve waardering|", ""),
        IF(?heeftReden, "verwijzing naar reden van bescherming|", "")
      ) AS ?_cats)
  BIND(REPLACE(?_cats, "\\|$", "") AS ?categorieen)
}