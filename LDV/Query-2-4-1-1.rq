#+ name: Query-2-4-1-1
#+ endpoint: https://api.linkeddata.cultureelerfgoed.nl/datasets/rce/Rijksmonumenten-sdo/sparql

PREFIX schema:<https://schema.org/>

SELECT
  (COUNT(DISTINCT ?choi) AS ?totaal)
  (SUM(IF(?heeftUitsluiting, 1, 0))         AS ?aantalUitsluiting)
  (SUM(IF(?heeftRelatieveWaardering, 1, 0)) AS ?aantalRelatieveWaardering)
  (SUM(IF(?heeftReden, 1, 0))               AS ?aantalReden)
WHERE {
  ?choi schema:description ?omschrijving .
  BIND(LCASE(STR(?omschrijving)) AS ?omslLc)

  ########################################
  # VALUES â€“ Query 2-schoon
  ########################################
  VALUES ?zoekterm {
    # Uitsluiting of beperking
    "niet beschermd" "niet-beschermd" "niet van waarde"
    "geen monumentale waarde" "geen onderdeel"
    "uitgesloten" "uitgezonderd"
    "niet opgenomen" "niet onder bescherming"
    "niet meebeschermd" "niet-meebeschermd"
    "niet in aanmerking" "buiten bescherming"
    "niet nader te beschermen"

    # Relatieve waardering
    "ondergeschikt" "van ondergeschikt belang"
    "ondergeschikte waarde" "ondergeschikte betekenis"
    "secundair" "geringe waarde" "weinig waarde" "storend"

    # Verwijzing naar reden van bescherming
    "onderdeel van" "in samenhang met"
    "aanmerking" "aanmerking voor"
  }

  FILTER(CONTAINS(?omslLc, LCASE(?zoekterm)))

  ########################################
  # Patronen
  ########################################
  BIND(
    "niet-?\\s*beschermd|niet\\s+van\\s+waarde|geen\\s+onderdeel|uitgezonderd|\\buitgesloten\\b|niet\\s+opgenomen|niet\\s+onder\\s+bescherming|niet-?\\s*meebeschermd|niet\\s+in\\s+aanmerking|buiten\\s+bescherming|niet\\s+nader\\s+te\\s+beschermen|geen\\s+monumentale\\s+waarde"
    AS ?patUitsl
  )

  BIND(
    "\\bondergeschikt(e)?\\b|van\\s+ondergeschikt\\s+belang|ondergeschikte\\s+waarde|ondergeschikte\\s+betekenis|\\bsecundair(e)?\\b|weinig\\s+waarde|van\\s+weinig\\s+waarde|\\bgering(e|ere)?\\b|van\\s+geringe\\s+waarde|\\bstorend\\b"
    AS ?patRel
  )

  BIND(
    "onderdeel\\s+van|in\\s+samenhang\\s+met|aanmerking\\s+voor|\\baanmerking\\b"
    AS ?patReden
  )

  ########################################
  # Detectie
  ########################################
  BIND(REGEX(?omslLc, ?patUitsl) AS ?heeftUitsluiting)
  BIND(REGEX(?omslLc, ?patRel)   AS ?heeftRelatieveWaardering)
  BIND(REGEX(?omslLc, ?patReden) AS ?heeftReden)

  FILTER(!REGEX(?omslLc, "van\\s+belang\\s+als\\s+onderdeel\\s+van"))
  FILTER(?heeftUitsluiting || ?heeftRelatieveWaardering || ?heeftReden)
}
